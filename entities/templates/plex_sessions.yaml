- sensor:
  - unique_id: plex_session_1
    name: Plex Session 1 (Tautulli)
    icon: mdi:plex
    state: >
      {% set sessions = state_attr('sensor.tautulli_activity', 'sessions') %}
      {% if sessions and sessions | length >= 1 %}
        {{ sessions[0].state }}
      {% else %}
        off
      {% endif %}
    attributes:
      user: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].user if s and s | length >= 1 and s[0].user is defined else 'unknown' }}
      progress_percent: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].progress_percent if s and s | length >= 1 and s[0].progress_percent is defined else 'unknown' }}
      media_type: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].media_type if s and s | length >= 1 and s[0].media_type is defined else 'unknown' }}
      full_title: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].full_title if s and s | length >= 1 and s[0].full_title is defined else 'unknown' }}
      grandparent_thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].grandparent_thumb if s and s | length >= 1 and s[0].grandparent_thumb is defined else 'unknown' }}
      thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].thumb if s and s | length >= 1 and s[0].thumb is defined else 'unknown' }}
      parent_media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].parent_media_index if s and s | length >= 1 and s[0].parent_media_index is defined else 'unknown' }}
      media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].media_index if s and s | length >= 1 and s[0].media_index is defined else 'unknown' }}
      year: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].year if s and s | length >= 1 and s[0].year is defined else 'unknown' }}
      product: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].product if s and s | length >= 1 and s[0].product is defined else 'unknown' }}
      player: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].player if s and s | length >= 1 and s[0].player is defined else 'unknown' }}
      device: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].device if s and s | length >= 1 and s[0].device is defined else 'unknown' }}
      platform: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].platform if s and s | length >= 1 and s[0].platform is defined else 'unknown' }}
      location: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].location if s and s | length >= 1 and s[0].location is defined else 'unknown' }}
      ip_address: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].ip_address if s and s | length >= 1 and s[0].ip_address is defined else 'unknown' }}
      ip_address_public: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].ip_address_public if s and s | length >= 1 and s[0].ip_address_public is defined else 'unknown' }}
      local: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].local if s and s | length >= 1 and s[0].local is defined else 'unknown' }}
      relayed: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].relayed if s and s | length >= 1 and s[0].relayed is defined else 'unknown' }}
      bandwidth: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].bandwidth if s and s | length >= 1 and s[0].bandwidth is defined else 'unknown' }}
      video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].video_resolution if s and s | length >= 1 and s[0].video_resolution is defined else 'unknown' }}
      stream_video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].stream_video_resolution if s and s | length >= 1 and s[0].stream_video_resolution is defined else 'unknown' }}
      transcode_decision: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[0].transcode_decision if s and s | length >= 1 and s[0].transcode_decision is defined else 'unknown' }}
- sensor:
  - unique_id: plex_session_2
    name: Plex Session 2 (Tautulli)
    icon: mdi:plex
    state: >
      {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
      {% if s and s | length >= 2 %}
        {{ s[1].state }}
      {% else %}
        off
      {% endif %}
    attributes:
      user: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].user if s and s | length >= 2 and s[1].user is defined else 'unknown' }}
      progress_percent: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].progress_percent if s and s | length >= 2 and s[1].progress_percent is defined else 'unknown' }}
      media_type: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].media_type if s and s | length >= 2 and s[1].media_type is defined else 'unknown' }}
      full_title: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].full_title if s and s | length >= 2 and s[1].full_title is defined else 'unknown' }}
      grandparent_thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].grandparent_thumb if s and s | length >= 2 and s[1].grandparent_thumb is defined else 'unknown' }}
      thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].thumb if s and s | length >= 2 and s[1].thumb is defined else 'unknown' }}
      parent_media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].parent_media_index if s and s | length >= 2 and s[1].parent_media_index is defined else 'unknown' }}
      media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].media_index if s and s | length >= 2 and s[1].media_index is defined else 'unknown' }}
      year: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].year if s and s | length >= 2 and s[1].year is defined else 'unknown' }}
      product: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].product if s and s | length >= 2 and s[1].product is defined else 'unknown' }}
      player: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].player if s and s | length >= 2 and s[1].player is defined else 'unknown' }}
      device: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].device if s and s | length >= 2 and s[1].device is defined else 'unknown' }}
      platform: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].platform if s and s | length >= 2 and s[1].platform is defined else 'unknown' }}
      location: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].location if s and s | length >= 2 and s[1].location is defined else 'unknown' }}
      ip_address: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].ip_address if s and s | length >= 2 and s[1].ip_address is defined else 'unknown' }}
      ip_address_public: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].ip_address_public if s and s | length >= 2 and s[1].ip_address_public is defined else 'unknown' }}
      local: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].local if s and s | length >= 2 and s[1].local is defined else 'unknown' }}
      relayed: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].relayed if s and s | length >= 2 and s[1].relayed is defined else 'unknown' }}
      bandwidth: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].bandwidth if s and s | length >= 2 and s[1].bandwidth is defined else 'unknown' }}
      video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].video_resolution if s and s | length >= 2 and s[1].video_resolution is defined else 'unknown' }}
      stream_video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].stream_video_resolution if s and s | length >= 2 and s[1].stream_video_resolution is defined else 'unknown' }}
      transcode_decision: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[1].transcode_decision if s and s | length >= 2 and s[1].transcode_decision is defined else 'unknown' }}
- sensor:
  - unique_id: plex_session_3
    name: Plex Session 3 (Tautulli)
    icon: mdi:plex
    state: >
      {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
      {% if s and s | length >= 3 %}
        {{ s[2].state }}
      {% else %}
        off
      {% endif %}
    attributes:
      user: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].user if s and s | length >= 3 and s[2].user is defined else 'unknown' }}
      progress_percent: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].progress_percent if s and s | length >= 3 and s[2].progress_percent is defined else 'unknown' }}
      media_type: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].media_type if s and s | length >= 3 and s[2].media_type is defined else 'unknown' }}
      full_title: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].full_title if s and s | length >= 3 and s[2].full_title is defined else 'unknown' }}
      grandparent_thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].grandparent_thumb if s and s | length >= 3 and s[2].grandparent_thumb is defined else 'unknown' }}
      thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].thumb if s and s | length >= 3 and s[2].thumb is defined else 'unknown' }}
      parent_media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].parent_media_index if s and s | length >= 3 and s[2].parent_media_index is defined else 'unknown' }}
      media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].media_index if s and s | length >= 3 and s[2].media_index is defined else 'unknown' }}
      year: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].year if s and s | length >= 3 and s[2].year is defined else 'unknown' }}
      product: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].product if s and s | length >= 3 and s[2].product is defined else 'unknown' }}
      player: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].player if s and s | length >= 3 and s[2].player is defined else 'unknown' }}
      device: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].device if s and s | length >= 3 and s[2].device is defined else 'unknown' }}
      platform: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].platform if s and s | length >= 3 and s[2].platform is defined else 'unknown' }}
      location: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].location if s and s | length >= 3 and s[2].location is defined else 'unknown' }}
      ip_address: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].ip_address if s and s | length >= 3 and s[2].ip_address is defined else 'unknown' }}
      ip_address_public: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].ip_address_public if s and s | length >= 3 and s[2].ip_address_public is defined else 'unknown' }}
      local: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].local if s and s | length >= 3 and s[2].local is defined else 'unknown' }}
      relayed: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].relayed if s and s | length >= 3 and s[2].relayed is defined else 'unknown' }}
      bandwidth: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].bandwidth if s and s | length >= 3 and s[2].bandwidth is defined else 'unknown' }}
      video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].video_resolution if s and s | length >= 3 and s[2].video_resolution is defined else 'unknown' }}
      stream_video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].stream_video_resolution if s and s | length >= 3 and s[2].stream_video_resolution is defined else 'unknown' }}
      transcode_decision: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[2].transcode_decision if s and s | length >= 3 and s[2].transcode_decision is defined else 'unknown' }}
- sensor:
  - unique_id: plex_session_4
    name: Plex Session 4 (Tautulli)
    icon: mdi:plex
    state: >
      {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
      {% if s and s | length >= 4 %}
        {{ s[3].state }}
      {% else %}
        off
      {% endif %}
    attributes:
      user: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].user if s and s | length >= 4 and s[3].user is defined else 'unknown' }}
      progress_percent: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].progress_percent if s and s | length >= 4 and s[3].progress_percent is defined else 'unknown' }}
      media_type: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].media_type if s and s | length >= 4 and s[3].media_type is defined else 'unknown' }}
      full_title: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].full_title if s and s | length >= 4 and s[3].full_title is defined else 'unknown' }}
      grandparent_thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].grandparent_thumb if s and s | length >= 4 and s[3].grandparent_thumb is defined else 'unknown' }}
      thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].thumb if s and s | length >= 4 and s[3].thumb is defined else 'unknown' }}
      parent_media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].parent_media_index if s and s | length >= 4 and s[3].parent_media_index is defined else 'unknown' }}
      media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].media_index if s and s | length >= 4 and s[3].media_index is defined else 'unknown' }}
      year: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].year if s and s | length >= 4 and s[3].year is defined else 'unknown' }}
      product: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].product if s and s | length >= 4 and s[3].product is defined else 'unknown' }}
      player: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].player if s and s | length >= 4 and s[3].player is defined else 'unknown' }}
      device: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].device if s and s | length >= 4 and s[3].device is defined else 'unknown' }}
      platform: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].platform if s and s | length >= 4 and s[3].platform is defined else 'unknown' }}
      location: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].location if s and s | length >= 4 and s[3].location is defined else 'unknown' }}
      ip_address: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].ip_address if s and s | length >= 4 and s[3].ip_address is defined else 'unknown' }}
      ip_address_public: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].ip_address_public if s and s | length >= 4 and s[3].ip_address_public is defined else 'unknown' }}
      local: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].local if s and s | length >= 4 and s[3].local is defined else 'unknown' }}
      relayed: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].relayed if s and s | length >= 4 and s[3].relayed is defined else 'unknown' }}
      bandwidth: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].bandwidth if s and s | length >= 4 and s[3].bandwidth is defined else 'unknown' }}
      video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].video_resolution if s and s | length >= 4 and s[3].video_resolution is defined else 'unknown' }}
      stream_video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].stream_video_resolution if s and s | length >= 4 and s[3].stream_video_resolution is defined else 'unknown' }}
      transcode_decision: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[3].transcode_decision if s and s | length >= 4 and s[3].transcode_decision is defined else 'unknown' }}
- sensor:
  - unique_id: plex_session_5
    name: Plex Session 5 (Tautulli)
    icon: mdi:plex
    state: >
      {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
      {% if s and s | length >= 5 %}
        {{ s[4].state }}
      {% else %}
        off
      {% endif %}
    attributes:
      user: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].user if s and s | length >= 5 and s[4].user is defined else 'unknown' }}
      progress_percent: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].progress_percent if s and s | length >= 5 and s[4].progress_percent is defined else 'unknown' }}
      media_type: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].media_type if s and s | length >= 5 and s[4].media_type is defined else 'unknown' }}
      full_title: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].full_title if s and s | length >= 5 and s[4].full_title is defined else 'unknown' }}
      grandparent_thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].grandparent_thumb if s and s | length >= 5 and s[4].grandparent_thumb is defined else 'unknown' }}
      thumb: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].thumb if s and s | length >= 5 and s[4].thumb is defined else 'unknown' }}
      parent_media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].parent_media_index if s and s | length >= 5 and s[4].parent_media_index is defined else 'unknown' }}
      media_index: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].media_index if s and s | length >= 5 and s[4].media_index is defined else 'unknown' }}
      year: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].year if s and s | length >= 5 and s[4].year is defined else 'unknown' }}
      product: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].product if s and s | length >= 5 and s[4].product is defined else 'unknown' }}
      player: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].player if s and s | length >= 5 and s[4].player is defined else 'unknown' }}
      device: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].device if s and s | length >= 5 and s[4].device is defined else 'unknown' }}
      platform: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].platform if s and s | length >= 5 and s[4].platform is defined else 'unknown' }}
      location: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].location if s and s | length >= 5 and s[4].location is defined else 'unknown' }}
      ip_address: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].ip_address if s and s | length >= 5 and s[4].ip_address is defined else 'unknown' }}
      ip_address_public: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].ip_address_public if s and s | length >= 5 and s[4].ip_address_public is defined else 'unknown' }}
      local: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].local if s and s | length >= 5 and s[4].local is defined else 'unknown' }}
      relayed: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].relayed if s and s | length >= 5 and s[4].relayed is defined else 'unknown' }}
      bandwidth: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].bandwidth if s and s | length >= 5 and s[4].bandwidth is defined else 'unknown' }}
      video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].video_resolution if s and s | length >= 5 and s[4].video_resolution is defined else 'unknown' }}
      stream_video_resolution: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].stream_video_resolution if s and s | length >= 5 and s[4].stream_video_resolution is defined else 'unknown' }}
      transcode_decision: >
        {% set s = state_attr('sensor.tautulli_activity', 'sessions') %}
        {{ s[4].transcode_decision if s and s | length >= 5 and s[4].transcode_decision is defined else 'unknown' }}
